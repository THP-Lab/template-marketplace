<% content_for :title, @product.title %>
<% content_for :meta_description,
                meta_description_from(@product.description) ||
                "Découvrir #{@product.title}, une création artisanale disponible dans notre boutique médiévale." %>
<% content_for :structured_data do %>
  <%= jsonld_tag(product_schema(@product)) %>
<% end %>



<div class="container py-4 mt-4">
  <%= link_to "Back to products", products_path, class:"btn btn-outline-primary mb-4" %>

  <%= render @product %>

  <div data-controller="quantity-modal">
    <%= button_tag "Ajouter au panier", type: "button", data: { action: "click->quantity-modal#open" }, class:"btn btn-primary" %>

    <dialog data-quantity-modal-target="dialog">
      <h3 class="text-center mb-4">Choisir la quantité</h3>
      <%= form_with url: cart_products_path, method: :post do %>
        <%= hidden_field_tag :product_id, @product.id %>
        <div>
          <%= number_field_tag :quantity, 1, min: 1 %>
        </div>
        <div class="mt-3">
          <%= button_tag "Ajouter et continuer mes achats", type: "submit", name: "redirect_to", value: "products", class:"btn btn-primary" %>
          <%= button_tag "Ajouter et aller au panier", type: "submit", name: "redirect_to", value: "cart", class:"btn btn-primary" %>
          <%= button_tag "Annuler", type: "button", data: { action: "click->quantity-modal#close" }, class:"btn btn-primary" %>
        </div>
      <% end %>
    </dialog>
  </div>
</div>
