<%= render @product %>

<div>
  <% if current_user.is_admin? %>
    <%= link_to "Edit this product", edit_product_path(@product) %> |
    <%= link_to "Back to products", products_path %>
    <div data-controller="quantity-modal">
      <%= button_tag "Ajouter au panier", type: "button", data: { action: "click->quantity-modal#open" } %>

      <dialog data-quantity-modal-target="dialog">
        <h3>Choisir la quantité</h3>
        <%= form_with url: cart_products_path, method: :post do %>
          <%= hidden_field_tag :product_id, @product.id %>
          <div>
            <%= number_field_tag :quantity, 1, min: 1 %>
          </div>
          <div style="margin-top: 8px;">
            <%= submit_tag "Ajouter" %>
            <%= button_tag "Annuler", type: "button", data: { action: "click->quantity-modal#close" } %>
          </div>
        <% end %>
      </dialog>
    </div>
    <%= button_to "Destroy this product", @product, method: :delete %>

  <% else %>
    <div data-controller="quantity-modal">
      <%= button_tag "Ajouter au panier", type: "button", data: { action: "click->quantity-modal#open" } %>

      <dialog data-quantity-modal-target="dialog">
        <h3>Choisir la quantité</h3>
        <%= form_with url: cart_products_path, method: :post do %>
          <%= hidden_field_tag :product_id, @product.id %>
          <div>
            <%= number_field_tag :quantity, 1, min: 1 %>
          </div>
          <div style="margin-top: 8px;">
            <%= submit_tag "Ajouter" %>
            <%= button_tag "Annuler", type: "button", data: { action: "click->quantity-modal#close" } %>
          </div>
        <% end %>
      </dialog>
    </div>
    <%= link_to "Back to products", products_path %>
  <% end %>
</div>
