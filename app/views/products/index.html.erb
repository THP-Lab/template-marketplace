<% if params[:success] %>
  <p>Paiement réussi ! </p>
<% elsif params[:canceled] %>
  <p>Paiement annulé.</p>
<% end %>

<% content_for :title, "Boutique" %>
<% if @selected_category.present? %>
  <% content_for :meta_description, "Créations #{@selected_category.to_s.titleize} : armures, bijoux et accessoires artisanaux en vente." %>
<% else %>
  <% content_for :meta_description, "Boutique médiévale : armures, bijoux, accessoires et vêtements forgés ou cousus à la main." %>
<% end %>
<% content_for :structured_data do %>
  <% listed_products = @products.respond_to?(:limit) ? @products.first(20) : Array(@products).first(20) %>
  <%= jsonld_tag(item_list_schema(listed_products,
                                  type: "Product",
                                  name: "Catalogue produits",
                                  url_proc: ->(product) { product_url(product) })) %>
<% end %>

<section class="section-wrapper">
  <h1 class="h1">Boutique</h1>

  <% filter_options = [["Toutes", ""]] + @categories.map { |cat| [cat.to_s.titleize, cat] } %>
  <div class="filters-bar">
    <p class="form-label">Filtres</p>
    <div class="filters" role="list">
      <% filter_options.each do |label, value| %>
        <% active = value.to_s == (@selected_category || "").to_s %>
        <%= link_to label,
                    products_path(category: value.presence),
                    class: ["filter-btn", ("filter-btn--active" if active)].compact.join(" ") %>
      <% end %>
    </div>
  </div>

  <div class="product-grid" id="products">
    <% @products.each do |product| %>
      <%= render product %>
    <% end %>
  </div>

  <%= link_to "New product", new_product_path, class: "btn btn--secondary" %>
</section>
